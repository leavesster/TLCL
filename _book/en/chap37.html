
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>37. 奇珍异宝 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="chap36.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="chap01.html">
            
                <a href="chap01.html">
            
                    
                    01. 引言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="chap02.html">
            
                <a href="chap02.html">
            
                    
                    02. 什么是 shell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="chap03.html">
            
                <a href="chap03.html">
            
                    
                    03. 文件系统中跳转
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="chap04.html">
            
                <a href="chap04.html">
            
                    
                    04. 探究操作系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="chap05.html">
            
                <a href="chap05.html">
            
                    
                    05. 操作文件和目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="chap06.html">
            
                <a href="chap06.html">
            
                    
                    06. 使用命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="chap07.html">
            
                <a href="chap07.html">
            
                    
                    07. 重定向
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="chap08.html">
            
                <a href="chap08.html">
            
                    
                    08. 从 shell 眼中看世界
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.9" data-path="chap09.html">
            
                <a href="chap09.html">
            
                    
                    09. 键盘高级操作技巧
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.10" data-path="chap10.html">
            
                <a href="chap10.html">
            
                    
                    10. 权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.11" data-path="chap11.html">
            
                <a href="chap11.html">
            
                    
                    11. 进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.12" data-path="chap12.html">
            
                <a href="chap12.html">
            
                    
                    12. shell 环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.13" data-path="chap13.html">
            
                <a href="chap13.html">
            
                    
                    13. vi 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.14" data-path="chap14.html">
            
                <a href="chap14.html">
            
                    
                    14. 自定制 shell 提示符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.15" data-path="chap15.html">
            
                <a href="chap15.html">
            
                    
                    15. 软件包管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.16" data-path="chap16.html">
            
                <a href="chap16.html">
            
                    
                    16. 存储媒介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.17" data-path="chap17.html">
            
                <a href="chap17.html">
            
                    
                    17. 网络系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.18" data-path="chap18.html">
            
                <a href="chap18.html">
            
                    
                    18. 查找文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.19" data-path="chap19.html">
            
                <a href="chap19.html">
            
                    
                    19. 归档和备份
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.20" data-path="chap20.html">
            
                <a href="chap20.html">
            
                    
                    20. 正则表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.21" data-path="chap21.html">
            
                <a href="chap21.html">
            
                    
                    21. 文本处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.22" data-path="chap22.html">
            
                <a href="chap22.html">
            
                    
                    22. 格式化输出
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.23" data-path="chap23.html">
            
                <a href="chap23.html">
            
                    
                    23. 打印
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.24" data-path="chap24.html">
            
                <a href="chap24.html">
            
                    
                    24. 编译程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.25" data-path="chap25.html">
            
                <a href="chap25.html">
            
                    
                    25. 编写第一个 Shell 脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.26" data-path="chap26.html">
            
                <a href="chap26.html">
            
                    
                    26. 启动一个项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.27" data-path="chap27.html">
            
                <a href="chap27.html">
            
                    
                    27. 自顶向下设计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.28" data-path="chap28.html">
            
                <a href="chap28.html">
            
                    
                    28. 流程控制：if 分支结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.29" data-path="chap29.html">
            
                <a href="chap29.html">
            
                    
                    29. 读取键盘输入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.30" data-path="chap30.html">
            
                <a href="chap30.html">
            
                    
                    30. 流程控制：while/until 循环
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.31" data-path="chap31.html">
            
                <a href="chap31.html">
            
                    
                    31. 疑难排解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.32" data-path="chap32.html">
            
                <a href="chap32.html">
            
                    
                    32. 流程控制：case 分支
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.33" data-path="chap33.html">
            
                <a href="chap33.html">
            
                    
                    33. 位置参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.34" data-path="chap34.html">
            
                <a href="chap34.html">
            
                    
                    34. 流程控制：for 循环
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.35" data-path="chap35.html">
            
                <a href="chap35.html">
            
                    
                    35. 字符串和数字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.36" data-path="chap36.html">
            
                <a href="chap36.html">
            
                    
                    36. 数组
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.37" data-path="chap37.html">
            
                <a href="chap37.html">
            
                    
                    37. 奇珍异宝
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >37. 奇珍异宝</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>In this, the final chapter of our journey, we will look at some odds and ends.
While we have certainly covered a lot of ground in the previous chapters,
there are many bash features that we have not covered. Most are fairly obscure,
and useful mainly to those integrating bash into a Linux distribution. However,
there are a few that, while not in common use, are helpful for certain
programming problems. We will cover them here.</p>
<p>&#x5728;&#x6211;&#x4EEC; bash &#x5B66;&#x4E60;&#x65C5;&#x7A0B;&#x4E2D;&#x7684;&#x6700;&#x540E;&#x4E00;&#x7AD9;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x770B;&#x4E00;&#x4E9B;&#x96F6;&#x661F;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#x3002;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x5DF2;&#x7ECF;
&#x6DB5;&#x76D6;&#x4E86;&#x5F88;&#x591A;&#x65B9;&#x9762;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x6709;&#x8BB8;&#x591A; bash &#x7279;&#x6027;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x6D89;&#x53CA;&#x5230;&#x3002;&#x5176;&#x4E2D;&#x5927;&#x90E8;&#x5206;&#x7279;&#x6027;&#x76F8;&#x5F53;&#x6666;&#x6DA9;&#xFF0C;&#x4E3B;&#x8981;&#x5BF9;
&#x90A3;&#x4E9B;&#x628A; bash &#x96C6;&#x6210;&#x5230; Linux &#x53D1;&#x884C;&#x7248;&#x7684;&#x7A0B;&#x5E8F;&#x6709;&#x7528;&#x5904;&#x3002;&#x7136;&#x800C;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x7279;&#x6027;&#xFF0C;&#x867D;&#x7136;&#x4E0D;&#x5E38;&#x7528;&#xFF0C;
&#x4F46;&#x662F;&#x5BF9;&#x67D0;&#x4E9B;&#x7A0B;&#x5E8F;&#x95EE;&#x9898;&#x662F;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x5B83;&#x4EEC;&#x3002;</p>
<h3 id="&#x7EC4;&#x547D;&#x4EE4;&#x548C;&#x5B50;-shell">&#x7EC4;&#x547D;&#x4EE4;&#x548C;&#x5B50; shell</h3>
<p>bash allows commands to be grouped together. This can be done in one of two ways;
either with a group command or with a subshell. Here are examples of the syntax of each:</p>
<p>bash &#x5141;&#x8BB8;&#x628A;&#x547D;&#x4EE4;&#x7EC4;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x5B8C;&#x6210;&#xFF1B;&#x8981;&#x4E48;&#x7528;&#x4E00;&#x4E2A; group &#x547D;&#x4EE4;&#xFF0C;&#x8981;&#x4E48;&#x7528;&#x4E00;&#x4E2A;&#x5B50; shell&#x3002;
&#x8FD9;&#x91CC;&#x662F;&#x6BCF;&#x79CD;&#x65B9;&#x5F0F;&#x7684;&#x8BED;&#x6CD5;&#x793A;&#x4F8B;&#xFF1A;</p>
<p>Group command:</p>
<p>&#x7EC4;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code>{ command1; command2; [command3; ...] }
</code></pre><p>Subshell:</p>
<p>&#x5B50; shell&#xFF1A;</p>
<pre><code>(command1; command2; [command3;...])
</code></pre><p>The two forms differ in that a group command surrounds its commands with braces and a
subshell uses parentheses. It is important to note that, due to the way bash implements
group commands, the braces must be separated from the commands by a space and the
last command must be terminated with either a semicolon or a newline prior to the closing brace.</p>
<p>&#x8FD9;&#x4E24;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5728;&#x4E8E;&#xFF0C;&#x7EC4;&#x547D;&#x4EE4;&#x7528;&#x82B1;&#x62EC;&#x53F7;&#x628A;&#x5B83;&#x7684;&#x547D;&#x4EE4;&#x5305;&#x88F9;&#x8D77;&#x6765;&#xFF0C;&#x800C;&#x5B50; shell &#x7528;&#x62EC;&#x53F7;&#x3002;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x9274;&#x4E8E; bash &#x5B9E;&#x73B0;&#x7EC4;&#x547D;&#x4EE4;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;
&#x82B1;&#x62EC;&#x53F7;&#x4E0E;&#x547D;&#x4EE4;&#x4E4B;&#x95F4;&#x5FC5;&#x987B;&#x6709;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#xFF0C;&#x5E76;&#x4E14;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x5FC5;&#x987B;&#x7528;&#x4E00;&#x4E2A;&#x5206;&#x53F7;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x6362;&#x884C;&#x7B26;&#x7EC8;&#x6B62;&#x3002;</p>
<p>So what are group commands and subshells good for? While they have an important
difference (which we will get to in a moment), they are both used to manage redirection.
Let&#x2019;s consider a script segment that performs redirections on multiple commands:</p>
<p>&#x90A3;&#x4E48;&#x7EC4;&#x547D;&#x4EE4;&#x548C;&#x5B50; shell &#x547D;&#x4EE4;&#x5BF9;&#x4EC0;&#x4E48;&#x6709;&#x597D;&#x5904;&#x5462;&#xFF1F; &#x5C3D;&#x7BA1;&#x5B83;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x5DEE;&#x5F02;&#xFF08;&#x6211;&#x4EEC;&#x9A6C;&#x4E0A;&#x4F1A;&#x63A5;&#x89E6;&#x5230;&#xFF09;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x7528;&#x6765;&#x7BA1;&#x7406;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x3002;
&#x8BA9;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x5BF9;&#x591A;&#x4E2A;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x811A;&#x672C;&#x7247;&#x6BB5;&#x3002;</p>
<pre><code>ls -l &gt; output.txt
echo &quot;Listing of foo.txt&quot; &gt;&gt; output.txt
cat foo.txt &gt;&gt; output.txt
</code></pre><p>This is pretty straightforward. Three commands with their output redirected to a file
named output.txt. Using a group command, we could code this as follows:</p>
<p>&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x76F8;&#x5F53;&#x7B80;&#x6D01;&#x660E;&#x4E86;&#x3002;&#x4E09;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x90FD;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; output.txt &#x7684;&#x6587;&#x4EF6;&#x4E2D;&#x3002;
&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7EC4;&#x547D;&#x4EE4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x7F16; &#x5199;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code>{ ls -l; echo &quot;Listing of foo.txt&quot;; cat foo.txt; } &gt; output.txt
</code></pre><p>Using a subshell is similar:</p>
<p>&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5B50; shell &#x662F;&#x76F8;&#x4F3C;&#x7684;&#xFF1A;</p>
<pre><code>(ls -l; echo &quot;Listing of foo.txt&quot;; cat foo.txt) &gt; output.txt
</code></pre><p>Using this technique we have saved ourselves some typing, but where a group command
or subshell really shines is with pipelines. When constructing a pipeline of commands, it
is often useful to combine the results of several commands into a single stream. Group
commands and subshells make this easy:</p>
<p>&#x4F7F;&#x7528;&#x8FD9;&#x6837;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x8282;&#x7701;&#x4E86;&#x4E00;&#x4E9B;&#x6253;&#x5B57;&#x65F6;&#x95F4;&#xFF0C;&#x4F46;&#x662F;&#x7EC4;&#x547D;&#x4EE4;&#x548C;&#x5B50; shell &#x771F;&#x6B63;&#x95EA;&#x5149;&#x7684;&#x5730;&#x65B9;&#x662F;&#x4E0E;&#x7BA1;&#x9053;&#x7EBF;&#x76F8;&#x7ED3;&#x5408;&#x3002;
&#x5F53;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x7BA1;&#x9053;&#x7EBF;&#x547D;&#x4EE4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x5E38;&#x628A;&#x51E0;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x6D41;&#x662F;&#x5F88;&#x6709;&#x7528;&#x7684;&#x3002;
&#x7EC4;&#x547D;&#x4EE4;&#x548C;&#x5B50; shell &#x4F7F;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#x53D8;&#x5F97;&#x5F88;&#x7B80;&#x5355;&#xFF1A;</p>
<pre><code>{ ls -l; echo &quot;Listing of foo.txt&quot;; cat foo.txt; } | lpr
</code></pre><p>Here we have combined the output of our three commands and piped them into the input
of lpr to produce a printed report.</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x628A;&#x6211;&#x4EEC;&#x7684;&#x4E09;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5408;&#x5E76;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x4EEC;&#x7528;&#x7BA1;&#x9053;&#x8F93;&#x9001;&#x7ED9;&#x547D;&#x4EE4; lpr &#x7684;&#x8F93;&#x5165;&#xFF0C;&#x4EE5;&#x4FBF;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x6253;&#x5370;&#x62A5;&#x544A;&#x3002;</p>
<p>In the script that follows, we will use groups commands and look at several programming
techniques that can be employed in conjunction with associative arrays. This script,
called array-2, when given the name of a directory, prints a listing of the files in the
directory along with the names of the the file&apos;s owner and group owner. At the end of
listing, the script prints a tally of the number of files belonging to each owner and group.
Here we see the results (condensed for brevity) when the script is given the directory /usr/bin:</p>
<p>&#x5728;&#x4E0B;&#x9762;&#x7684;&#x811A;&#x672C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;&#x7EC4;&#x547D;&#x4EE4;&#xFF0C;&#x770B;&#x51E0;&#x4E2A;&#x4E0E;&#x5173;&#x8054;&#x6570;&#x7EC4;&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x7684;&#x7F16;&#x7A0B;&#x6280;&#x5DE7;&#x3002;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#xFF0C;&#x79F0;&#x4E3A; array-2&#xFF0C;&#x5F53;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x540D;&#xFF0C;&#x6253;&#x5370;&#x51FA;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#xFF0C;
&#x4F34;&#x968F;&#x7740;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x6240;&#x6709;&#x8005;&#x548C;&#x7EC4;&#x6240;&#x6709;&#x8005;&#x3002;&#x5728;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x7684;&#x672B;&#x5C3E;&#xFF0C;&#x811A;&#x672C;&#x6253;&#x5370;&#x51FA;&#x5C5E;&#x4E8E;&#x6BCF;&#x4E2A;&#x6240;&#x6709;&#x8005;&#x548C;&#x7EC4;&#x7684;&#x6587;&#x4EF6;&#x6570;&#x76EE;&#x3002;
&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#xFF08;&#x4E3A;&#x7B80;&#x5355;&#x8D77;&#x89C1;&#x800C;&#x7F29;&#x77ED;&#x7684;&#xFF09;&#x7ED3;&#x679C;&#xFF0C;&#x662F;&#x7ED9;&#x5B9A;&#x811A;&#x672C;&#x7684;&#x76EE;&#x5F55;&#x4E3A; /usr/bin &#x7684;&#x65F6;&#x5019;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ array-2 /usr/bin
/usr/bin/2to3-2.6                 root        root
/usr/bin/2to3                     root        root
/usr/bin/a2p                      root        root
/usr/bin/abrowser                 root        root
/usr/bin/aconnect                 root        root
/usr/bin/acpi_fakekey             root        root
/usr/bin/acpi_listen              root        root
/usr/bin/add-apt-repository       root        root
.
.
.
/usr/bin/zipgrep                  root        root
/usr/bin/zipinfo                  root        root
/usr/bin/zipnote                  root        root
/usr/bin/zip                      root        root
/usr/bin/zipsplit                 root        root
/usr/bin/zjsdecode                root        root
/usr/bin/zsoelim                  root        root

File owners:
daemon  : 1 file(s)
root    : 1394 file(s) File group owners:
crontab : 1 file(s)
daemon  : 1 file(s)
lpadmin : 1 file(s)
mail    : 4 file(s)
mlocate : 1 file(s)
root    : 1380 file(s)
shadow  : 2 file(s)
ssh     : 1 file(s)
tty     : 2 file(s)
utmp    : 2 file(s)
</code></pre><p>Here is a listing (with line numbers) of the script:</p>
<p>&#x8FD9;&#x91CC;&#x662F;&#x811A;&#x672C;&#x4EE3;&#x7801;&#x5217;&#x8868;&#xFF08;&#x5E26;&#x6709;&#x884C;&#x53F7;&#xFF09;&#xFF1A;</p>
<pre><code>1     #!/bin/bash
2
3     # array-2: Use arrays to tally file owners
4
5     declare -A files file_group file_owner groups owners
6
7     if [[ ! -d &quot;$1&quot; ]]; then
8        echo &quot;Usage: array-2 dir&quot; &gt;&amp;2
9        exit 1
10    fi
11
12    for i in &quot;$1&quot;/*; do
13       owner=$(stat -c %U &quot;$i&quot;)
14       group=$(stat -c %G &quot;$i&quot;)
15        files[&quot;$i&quot;]=&quot;$i&quot;
16        file_owner[&quot;$i&quot;]=$owner
17        file_group[&quot;$i&quot;]=$group
18        ((++owners[$owner]))
19        ((++groups[$group]))
20    done
21
22    # List the collected files
23    { for i in &quot;${files[@]}&quot;; do
24    printf &quot;%-40s %-10s %-10s\n&quot; \
25    &quot;$i&quot; ${file_owner[&quot;$i&quot;]} ${file_group[&quot;$i&quot;]}
26    done } | sort
27    echo
28
29   # List owners
30    echo &quot;File owners:&quot;
31    { for i in &quot;${!owners[@]}&quot;; do
32    printf &quot;%-10s: %5d file(s)\n&quot; &quot;$i&quot; ${owners[&quot;$i&quot;]}
33    done } | sort
34    echo
35
36    # List groups
37    echo &quot;File group owners:&quot;
38    { for i in &quot;${!groups[@]}&quot;; do
39    printf &quot;%-10s: %5d file(s)\n&quot; &quot;$i&quot; ${groups[&quot;$i&quot;]}
40    done } | sort
</code></pre><p>Let&apos;s take a look at the mechanics of this script:</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x7684;&#x8FD0;&#x884C;&#x673A;&#x5236;&#xFF1A;</p>
<p>Line 5: Associative arrays must be created with the declare command using the -A
option. In this script we create five arrays as follows:</p>
<p>&#x884C;5&#xFF1A; &#x5173;&#x8054;&#x6570;&#x7EC4;&#x5FC5;&#x987B;&#x7528;&#x5E26;&#x6709; -A &#x9009;&#x9879;&#x7684; declare &#x547D;&#x4EE4;&#x521B;&#x5EFA;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x4E2D;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;&#x5982;&#x4E0B;&#x4E94;&#x4E2A;&#x6570;&#x7EC4;&#xFF1A;</p>
<p>files contains the names of the files in the directory, indexed by filename</p>
<p>file_group contains the group owner of each file, indexed by filename</p>
<p>file_owner contains the owner of each file, indexed by file name</p>
<p>groups contains the number of files belonging to the indexed group</p>
<p>owners contains the number of files belonging to the indexed owner</p>
<p>files &#x5305;&#x542B;&#x4E86;&#x76EE;&#x5F55;&#x4E2D;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x6309;&#x6587;&#x4EF6;&#x540D;&#x7D22;&#x5F15;</p>
<p>file_group &#x5305;&#x542B;&#x4E86;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x7EC4;&#x6240;&#x6709;&#x8005;&#xFF0C;&#x6309;&#x6587;&#x4EF6;&#x540D;&#x7D22;&#x5F15;</p>
<p>file_owner &#x5305;&#x542B;&#x4E86;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x8005;&#xFF0C;&#x6309;&#x6587;&#x4EF6;&#x540D;&#x7D22;&#x5F15;</p>
<p>groups &#x5305;&#x542B;&#x4E86;&#x5C5E;&#x4E8E;&#x7D22;&#x5F15;&#x7684;&#x7EC4;&#x7684;&#x6587;&#x4EF6;&#x6570;&#x76EE;</p>
<p>owners &#x5305;&#x542B;&#x4E86;&#x5C5E;&#x4E8E;&#x7D22;&#x5F15;&#x7684;&#x6240;&#x6709;&#x8005;&#x7684;&#x6587;&#x4EF6;&#x6570;&#x76EE;</p>
<p>Lines 7-10: Checks to see that a valid directory name was passed as a positional
parameter. If not, a usage message is displayed and the script exits with an exit status of 1.</p>
<p>&#x884C;7-10&#xFF1A;&#x67E5;&#x770B;&#x662F;&#x5426;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;&#x76EE;&#x5F55;&#x540D;&#x4F5C;&#x4E3A;&#x4F4D;&#x7F6E;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x7A0B;&#x5E8F;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5C31;&#x4F1A;&#x663E;&#x793A;&#x4E00;&#x6761;&#x4F7F;&#x7528;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x811A;&#x672C;&#x9000;&#x51FA;&#xFF0C;&#x9000;&#x51FA;&#x72B6;&#x6001;&#x4E3A;1&#x3002;</p>
<p>Lines 12-20: Loop through the files in the directory. Using the stat command, lines
13 and 14 extract the names of the file owner and group owner and assign the values to
their respective arrays (lines 16, 17) using the name of the file as the array index. Likewise
the file name itself is assigned to the files array (line 15).</p>
<p>&#x884C;12-20&#xFF1A;&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x3002;&#x4F7F;&#x7528; stat &#x547D;&#x4EE4;&#xFF0C;&#x884C;13&#x548C;&#x884C;14&#x62BD;&#x53D6;&#x6587;&#x4EF6;&#x6240;&#x6709;&#x8005;&#x548C;&#x7EC4;&#x6240;&#x6709;&#x8005;&#xFF0C;
&#x5E76;&#x628A;&#x503C;&#x8D4B;&#x7ED9;&#x5B83;&#x4EEC;&#x5404;&#x81EA;&#x7684;&#x6570;&#x7EC4;&#xFF08;&#x884C;16&#xFF0C;17&#xFF09;&#xFF0C;&#x4F7F;&#x7528;&#x6587;&#x4EF6;&#x540D;&#x4F5C;&#x4E3A;&#x6570;&#x7EC4;&#x7D22;&#x5F15;&#x3002;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x81EA;&#x8EAB;&#x4E5F;&#x8D4B;&#x503C;&#x7ED9; files &#x6570;&#x7EC4;&#x3002;</p>
<p>Lines 18-19: The total number of files belonging to the file owner and group owner are
incremented by one.</p>
<p>&#x884C;18-19&#xFF1A;&#x5C5E;&#x4E8E;&#x6587;&#x4EF6;&#x6240;&#x6709;&#x8005;&#x548C;&#x7EC4;&#x6240;&#x6709;&#x8005;&#x7684;&#x6587;&#x4EF6;&#x603B;&#x6570;&#x5404;&#x81EA;&#x52A0;1&#x3002;</p>
<p>Lines 22-27: The list of files is output. This is done using the &quot;${array[@]}&quot; parameter
expansion which expands into the entire list of array element with each element treated as
a separate word. This allows for the possibility that a file name may contain embedded
spaces. Also note that the entire loop is enclosed in braces thus forming a group command.
This permits the entire output of the loop to be piped into the sort command.
This is necessary because the expansion of the array elements is not sorted.</p>
<p>&#x884C;22-27&#xFF1A;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x3002;&#x4E3A;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x4F7F;&#x7528;&#x4E86; &#x201C;${array[@]}&#x201D; &#x53C2;&#x6570;&#x5C55;&#x5F00;&#xFF0C;&#x5C55;&#x5F00;&#x6210;&#x6574;&#x4E2A;&#x7684;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x5217;&#x8868;&#xFF0C;
&#x5E76;&#x4E14;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x88AB;&#x5F53;&#x505A;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x8BCD;&#x3002;&#x4ECE;&#x800C;&#x5141;&#x8BB8;&#x6587;&#x4EF6;&#x540D;&#x5305;&#x542B;&#x7A7A;&#x683C;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x4E5F;&#x8981;&#x6CE8;&#x610F;&#x5230;&#x6574;&#x4E2A;&#x5FAA;&#x73AF;&#x662F;&#x5305;&#x88F9;&#x5728;&#x82B1;&#x62EC;&#x53F7;&#x4E2D;&#xFF0C;
&#x4ECE;&#x800C;&#x5F62;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x7EC4;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x5141;&#x8BB8;&#x6574;&#x4E2A;&#x5FAA;&#x73AF;&#x8F93;&#x51FA;&#x4F1A;&#x88AB;&#x7BA1;&#x9053;&#x8F93;&#x9001;&#x7ED9; sort &#x547D;&#x4EE4;&#x7684;&#x8F93;&#x5165;&#x3002;&#x8FD9;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;
&#x5C55;&#x5F00;&#x7684;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x662F;&#x65E0;&#x5E8F;&#x7684;&#x3002;</p>
<p>Lines 29-40: These two loops are similar to the file list loop except that they use the &quot;${!
array[@]}&quot; expansion which expands into the list of array indexes rather than the list of
array elements.</p>
<p>&#x884C;29-40&#xFF1A;&#x8FD9;&#x4E24;&#x4E2A;&#x5FAA;&#x73AF;&#x4E0E;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x5FAA;&#x73AF;&#x76F8;&#x4F3C;&#xFF0C;&#x9664;&#x4E86;&#x5B83;&#x4EEC;&#x4F7F;&#x7528; &#x201C;${!array[@]}&#x201D; &#x5C55;&#x5F00;&#xFF0C;&#x5C55;&#x5F00;&#x6210;&#x6570;&#x7EC4;&#x7D22;&#x5F15;&#x7684;&#x5217;&#x8868;
&#x800C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x7684;&#x3002;</p>
<h4 id="&#x8FDB;&#x7A0B;&#x66FF;&#x6362;">&#x8FDB;&#x7A0B;&#x66FF;&#x6362;</h4>
<p>While they look similar and can both be used to combine streams for redirection, there is
an important difference between group commands and subshells. Whereas a group command
executes all of its commands in the current shell, a subshell (as the name suggests)
executes its commands in a child copy of the current shell. This means that the environment
is copied and given to a new instance of the shell. When the subshell exits, the copy
of the environment is lost, so any changes made to the subshell&#x2019;s environment (including
variable assignment) is lost as well. Therefore, in most cases, unless a script requires a
subshell, group commands are preferable to subshells. Group commands are both faster
and require less memory.</p>
<p>&#x867D;&#x7136;&#x7EC4;&#x547D;&#x4EE4;&#x548C;&#x5B50; shell &#x770B;&#x8D77;&#x6765;&#x76F8;&#x4F3C;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4EEC;&#x90FD;&#x80FD;&#x7528;&#x6765;&#x5728;&#x91CD;&#x5B9A;&#x5411;&#x4E2D;&#x5408;&#x5E76;&#x6D41;&#xFF0C;&#x4F46;&#x662F;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x3002;
&#x7136;&#x800C;&#xFF0C;&#x4E00;&#x4E2A;&#x7EC4;&#x547D;&#x4EE4;&#x5728;&#x5F53;&#x524D; shell &#x4E2D;&#x6267;&#x884C;&#x5B83;&#x7684;&#x6240;&#x6709;&#x547D;&#x4EE4;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;&#x5B50; shell&#xFF08;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF09;&#x5728;&#x5F53;&#x524D; shell &#x7684;&#x4E00;&#x4E2A;
&#x5B50;&#x526F;&#x672C;&#x4E2D;&#x6267;&#x884C;&#x5B83;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x88AB;&#x590D;&#x5236;&#x7ED9;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684; shell &#x5B9E;&#x4F8B;&#x3002;&#x5F53;&#x8FD9;&#x4E2A;&#x5B50; shell &#x9000;&#x51FA;&#x65F6;&#xFF0C;&#x73AF;&#x5883;&#x526F;&#x672C;&#x4F1A;&#x6D88;&#x5931;&#xFF0C;
&#x6240;&#x4EE5;&#x5728;&#x5B50; shell &#x73AF;&#x5883;&#xFF08;&#x5305;&#x62EC;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#xFF09;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x66F4;&#x6539;&#x4E5F;&#x4F1A;&#x6D88;&#x5931;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9664;&#x975E;&#x811A;&#x672C;&#x8981;&#x6C42;&#x4E00;&#x4E2A;&#x5B50; shell&#xFF0C;
&#x7EC4;&#x547D;&#x4EE4;&#x6BD4;&#x5B50; shell &#x66F4;&#x53D7;&#x6B22;&#x8FCE;&#x3002;&#x7EC4;&#x547D;&#x4EE4;&#x8FD0;&#x884C;&#x5F88;&#x5FEB;&#x5E76;&#x4E14;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x4E5F;&#x5C11;&#x3002;</p>
<p>We saw an example of the subshell environment problem in Chapter 28,
when we discovered that a read command in a pipeline does not work as we might intuitively expect.
To recap, if we construct a pipeline like this:</p>
<p>&#x6211;&#x4EEC;&#x5728;&#x7B2C;20&#x7AE0;&#x4E2D;&#x770B;&#x5230;&#x8FC7;&#x4E00;&#x4E2A;&#x5B50; shell &#x8FD0;&#x884C;&#x73AF;&#x5883;&#x95EE;&#x9898;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x7BA1;&#x9053;&#x7EBF;&#x4E2D;&#x7684;&#x4E00;&#x4E2A; read &#x547D;&#x4EE4;
&#x4E0D;&#x6309;&#x6211;&#x4EEC;&#x6240;&#x671F;&#x671B;&#x7684;&#x90A3;&#x6837;&#x5DE5;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#x3002;&#x4E3A;&#x4E86;&#x91CD;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x7BA1;&#x9053;&#x7EBF;&#xFF1A;</p>
<pre><code>echo &quot;foo&quot; | read
echo $REPLY
</code></pre><p>The content of the REPLY variable is always empty because the read command is executed
in a subshell, and its copy of REPLY is destroyed when the subshell terminates.
Because commands in pipelines are always executed in subshells, any command that assigns
variables will encounter this issue. Fortunately, the shell provides an exotic form of
expansion called process substitution that can be used to work around this problem.
Process substitution is expressed in two ways:</p>
<p>&#x8BE5; REPLY &#x53D8;&#x91CF;&#x7684;&#x5185;&#x5BB9;&#x603B;&#x662F;&#x4E3A;&#x7A7A;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A; read &#x547D;&#x4EE4;&#x5728;&#x4E00;&#x4E2A;&#x5B50; shell &#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x8BE5;&#x5B50; shell &#x7EC8;&#x6B62;&#x7684;&#x65F6;&#x5019;&#xFF0C;
&#x5B83;&#x7684; REPLY &#x526F;&#x672C;&#x4F1A;&#x88AB;&#x6BC1;&#x6389;&#x3002;&#x56E0;&#x4E3A;&#x7BA1;&#x9053;&#x7EBF;&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x603B;&#x662F;&#x5728;&#x5B50; shell &#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x4EFB;&#x4F55;&#x7ED9;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x7684;&#x547D;&#x4EE4;&#x90FD;&#x4F1A;&#x906D;&#x9047;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#x3002;
&#x5E78;&#x8FD0;&#x5730;&#x662F;&#xFF0C;shell &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x5947;&#x5F02;&#x7684;&#x5C55;&#x5F00;&#x65B9;&#x5F0F;&#xFF0C;&#x53EB;&#x505A;&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x79CD;&#x9EBB;&#x70E6;&#x3002;&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#x6709;&#x4E24;&#x79CD;&#x8868;&#x8FBE;&#x65B9;&#x5F0F;&#xFF1A;</p>
<p>For processes that produce standard output:</p>
<p>&#x4E00;&#x79CD;&#x9002;&#x7528;&#x4E8E;&#x4EA7;&#x751F;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x7684;&#x8FDB;&#x7A0B;&#xFF1A;</p>
<pre><code>&lt;(list)
</code></pre><p>or, for processes that intake standard input:</p>
<p>&#x53E6;&#x4E00;&#x79CD;&#x9002;&#x7528;&#x4E8E;&#x63A5;&#x53D7;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x7684;&#x8FDB;&#x7A0B;&#xFF1A;</p>
<pre><code>&gt;(list)
</code></pre><p>where list is a list of commands.</p>
<p>&#x8FD9;&#x91CC;&#x7684; list &#x662F;&#x4E00;&#x4E32;&#x547D;&#x4EE4;&#x5217;&#x8868;&#xFF1A;</p>
<p>To solve our problem with read, we can employ process substitution like this:</p>
<p>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x6211;&#x4EEC;&#x7684; read &#x547D;&#x4EE4;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x96C7;&#x4F63;&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code>read &lt; &lt;(echo &quot;foo&quot;)
echo $REPLY
</code></pre><p>Process substitution allows us to treat the output of a subshell as an ordinary file for
purposes of redirection. In fact, since it is a form of expansion, we can examine its real value:</p>
<p>&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x628A;&#x4E00;&#x4E2A;&#x5B50; shell &#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x666E;&#x901A;&#x6587;&#x4EF6;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x5C55;&#x5F00;&#x5F62;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x68C0;&#x9A8C;&#x5B83;&#x7684;&#x771F;&#x5B9E;&#x503C;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ echo &lt;(echo &quot;foo&quot;)
/dev/fd/63
</code></pre><p>By using echo to view the result of the expansion, we see that the output of the subshell
is being provided by a file named /dev/fd/63.</p>
<p>&#x901A;&#x8FC7;&#x4F7F;&#x7528; echo &#x547D;&#x4EE4;&#xFF0C;&#x67E5;&#x770B;&#x5C55;&#x5F00;&#x7ED3;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x5B50; shell &#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#xFF0C;&#x7531;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; /dev/fd/63 &#x7684;&#x6587;&#x4EF6;&#x63D0;&#x4F9B;&#x3002;</p>
<p>Process substitution is often used with loops containing read. Here is an example of a
read loop that processes the contents of a directory listing created by a subshell:</p>
<p>&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#x7ECF;&#x5E38;&#x88AB;&#x5305;&#x542B; read &#x547D;&#x4EE4;&#x7684;&#x5FAA;&#x73AF;&#x7528;&#x5230;&#x3002;&#x8FD9;&#x91CC;&#x662F;&#x4E00;&#x4E2A; read &#x5FAA;&#x73AF;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5904;&#x7406;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x5217;&#x8868;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5185;&#x5BB9;&#x521B;&#x5EFA;&#x4E8E;&#x4E00;&#x4E2A;&#x5B50; shell&#xFF1A;</p>
<pre><code>#!/bin/bash
# pro-sub : demo of process substitution
while read attr links owner group size date time filename; do
    cat &lt;&lt;- EOF
        Filename:     $filename
        Size:         $size
        Owner:        $owner
        Group:        $group
        Modified:     $date $time
        Links:        $links
        Attributes:   $attr
    EOF
done &lt; &lt;(ls -l | tail -n +2)
</code></pre><p>The loop executes read for each line of a directory listing. The listing itself is produced
on the final line of the script. This line redirects the output of the process substitution into
the standard input of the loop. The tail command is included in the process substitution
pipeline to eliminate the first line of the listing, which is not needed.</p>
<p>&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x5BF9;&#x76EE;&#x5F55;&#x5217;&#x8868;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x6761;&#x76EE;&#x6267;&#x884C; read &#x547D;&#x4EE4;&#x3002;&#x5217;&#x8868;&#x672C;&#x8EAB;&#x4EA7;&#x751F;&#x4E8E;&#x8BE5;&#x811A;&#x672C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x628A;&#x4ECE;&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#x5F97;&#x5230;&#x7684;&#x8F93;&#x51FA;
&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x3002;&#x8FD9;&#x4E2A;&#x5305;&#x542B;&#x5728;&#x7BA1;&#x9053;&#x7EBF;&#x4E2D;&#x7684; tail &#x547D;&#x4EE4;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x6D88;&#x9664;&#x5217;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x884C;&#x6587;&#x672C;&#xFF0C;&#x8FD9;&#x884C;&#x6587;&#x672C;&#x662F;&#x591A;&#x4F59;&#x7684;&#x3002;</p>
<p>When executed, the script produces output like this:</p>
<p>&#x5F53;&#x811A;&#x672C;&#x6267;&#x884C;&#x540E;&#xFF0C;&#x811A;&#x672C;&#x4EA7;&#x751F;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x8F93;&#x51FA;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ pro_sub | head -n 20
Filename: addresses.ldif
Size: 14540
Owner: me
Group: me
Modified: 2009-04-02 11:12
Links:
1
Attributes: -rw-r--r--
Filename: bin
Size: 4096
Owner: me
Group: me
Modified: 2009-07-10 07:31
Links: 2
Attributes: drwxr-xr-x
Filename: bookmarks.html
Size: 394213
Owner: me
Group: me
</code></pre><h3 id="&#x9677;&#x9631;">&#x9677;&#x9631;</h3>
<p>In Chapter 10, we saw how programs can respond to signals. We can add this capability
to our scripts, too. While the scripts we have written so far have not needed this capabil-
ity (because they have very short execution times, and do not create temporary files),
larger and more complicated scripts may benefit from having a signal handling routine.</p>
<p>&#x5728;&#x7B2C;10&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x8FC7;&#x7A0B;&#x5E8F;&#x662F;&#x600E;&#x6837;&#x54CD;&#x5E94;&#x4FE1;&#x53F7;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x6DFB;&#x52A0;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x811A;&#x672C;&#x4E2D;&#x3002;&#x7136;&#x800C;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;
&#x6211;&#x4EEC;&#x6240;&#x7F16;&#x5199;&#x8FC7;&#x7684;&#x811A;&#x672C;&#x8FD8;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x79CD;&#x529F;&#x80FD;&#xFF08;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x975E;&#x5E38;&#x77ED;&#x6682;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF09;&#xFF0C;&#x5927;&#x4E14;&#x66F4;&#x590D;&#x6742;&#x7684;&#x811A;&#x672C;
&#x53EF;&#x80FD;&#x4F1A;&#x53D7;&#x76CA;&#x4E8E;&#x4E00;&#x4E2A;&#x4FE1;&#x606F;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>When we design a large, complicated script, it is important to consider what happens if
the user logs off or shuts down the computer while the script is running. When such an
event occurs, a signal will be sent to all affected processes. In turn, the programs repre-
senting those processes can perform actions to ensure a proper and orderly termination of
the program. Let&#x2019;s say, for example, that we wrote a script that created a temporary file
during its execution. In the course of good design, we would have the script delete the file
when the script finishes its work. It would also be smart to have the script delete the file
if a signal is received indicating that the program was going to be terminated prematurely.</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#xFF0C;&#x590D;&#x6742;&#x7684;&#x811A;&#x672C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x82E5;&#x811A;&#x672C;&#x4ECD;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x6CE8;&#x9500;&#x6216;&#x5173;&#x95ED;&#x4E86;&#x7535;&#x8111;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#xFF0C;&#x8003;&#x8651;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;
&#x5F53;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#x53D1;&#x751F;&#x4E86;&#xFF0C;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x5C06;&#x4F1A;&#x53D1;&#x9001;&#x7ED9;&#x6240;&#x6709;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x4F9D;&#x6B21;&#x5730;&#xFF0C;&#x4EE3;&#x8868;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x7684;&#x7A0B;&#x5E8F;&#x4F1A;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;&#x6765;&#x786E;&#x4FDD;&#x7A0B;&#x5E8F;
&#x5408;&#x7406;&#x6709;&#x5E8F;&#x7684;&#x7EC8;&#x6B62;&#x3002;&#x6BD4;&#x65B9;&#x8BF4;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x7F16;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x4F1A;&#x5728;&#x6267;&#x884C;&#x65F6;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x7684;&#x811A;&#x672C;&#x3002;&#x5728;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x8BBE;&#x8BA1;&#x6D41;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x8BA9;&#x811A;&#x672C;&#x5220;&#x9664;&#x521B;&#x5EFA;&#x7684;
&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x5F53;&#x811A;&#x672C;&#x5B8C;&#x6210;&#x5B83;&#x7684;&#x4EFB;&#x52A1;&#x4E4B;&#x540E;&#x3002;&#x82E5;&#x811A;&#x672C;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#xFF0C;&#x8868;&#x660E;&#x8BE5;&#x7A0B;&#x5E8F;&#x5373;&#x5C06;&#x63D0;&#x524D;&#x7EC8;&#x6B62;&#x7684;&#x4FE1;&#x53F7;&#xFF0C;
&#x6B64;&#x65F6;&#x8BA9;&#x811A;&#x672C;&#x5220;&#x9664;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x4F1A;&#x662F;&#x5F88;&#x7CBE;&#x5DE7;&#x7684;&#x8BBE;&#x8BA1;&#x3002;</p>
<p>bash provides a mechanism for this purpose known as a trap. Traps are implemented
with the appropriately named builtin command, trap. trap uses the following syntax:</p>
<p>&#x4E3A;&#x6EE1;&#x8DB3;&#x8FD9;&#x6837;&#x9700;&#x6C42;&#xFF0C;bash &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x4F17;&#x6240;&#x5468;&#x77E5;&#x7684; trap&#x3002;&#x9677;&#x9631;&#x6B63;&#x597D;&#x7531;&#x5185;&#x90E8;&#x547D;&#x4EE4; trap &#x5B9E;&#x73B0;&#x3002;
trap &#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x8BED;&#x6CD5;&#xFF1A;</p>
<pre><code>trap argument signal [signal...]
</code></pre><p>where argument is a string which will be read and treated as a command and signal is the
specification of a signal that will trigger the execution of the interpreted command.</p>
<p>&#x8FD9;&#x91CC;&#x7684; argument &#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5B83;&#x88AB;&#x8BFB;&#x53D6;&#x5E76;&#x88AB;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;signal &#x662F;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x7684;&#x8BF4;&#x660E;&#xFF0C;&#x5B83;&#x4F1A;&#x89E6;&#x53D1;&#x6267;&#x884C;&#x6240;&#x8981;&#x89E3;&#x91CA;&#x7684;&#x547D;&#x4EE4;&#x3002;</p>
<p>Here is a simple example:</p>
<p>&#x8FD9;&#x91CC;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code>#!/bin/bash
# trap-demo : simple signal handling demo
trap &quot;echo &apos;I am ignoring you.&apos;&quot; SIGINT SIGTERM
for i in {1..5}; do
    echo &quot;Iteration $i of 5&quot;
    sleep 5
done
</code></pre><p>This script defines a trap that will execute an echo command each time either the
SIGINT or SIGTERM signal is received while the script is running. Execution of
the program looks like this when the user attempts to stop the script by pressing Ctrl-c:</p>
<p>&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x9677;&#x9631;&#xFF0C;&#x5F53;&#x811A;&#x672C;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E2A;&#x9677;&#x9631;&#x6BCF;&#x5F53;&#x63A5;&#x53D7;&#x5230;&#x4E00;&#x4E2A; SIGINT &#x6216; SIGTERM &#x4FE1;&#x53F7;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x4E00;&#x4E2A; echo &#x547D;&#x4EE4;&#x3002;
&#x5F53;&#x7528;&#x6237;&#x8BD5;&#x56FE;&#x901A;&#x8FC7;&#x6309;&#x4E0B; Ctrl-c &#x7EC4;&#x5408;&#x952E;&#x7EC8;&#x6B62;&#x811A;&#x672C;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BE5;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ trap-demo
Iteration 1 of 5
Iteration 2 of 5
I am ignoring you.
Iteration 3 of 5
I am ignoring you.
Iteration 4 of 5
Iteration 5 of 5
</code></pre><p>As we can see, each time the user attempts to interrupt the program, the message is
printed instead.</p>
<p>&#x6B63;&#x5982;&#x6211;&#x4EEC;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;&#x6BCF;&#x6B21;&#x7528;&#x6237;&#x8BD5;&#x56FE;&#x4E2D;&#x65AD;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x4F1A;&#x6253;&#x5370;&#x51FA;&#x8FD9;&#x6761;&#x4FE1;&#x606F;&#x3002;</p>
<p>Constructing a string to form a useful sequence of commands can be awkward, so it is
common practice to specify a shell function as the command. In this example, a separate
shell function is specified for each signal to be handled:</p>
<p>&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x6765;&#x5F62;&#x6210;&#x4E00;&#x4E2A;&#x6709;&#x7528;&#x7684;&#x547D;&#x4EE4;&#x5E8F;&#x5217;&#x662F;&#x5F88;&#x7B28;&#x62D9;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x6307;&#x5B9A;&#x4E00;&#x4E2A; shell &#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x547D;&#x4EE4;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;
&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684; shell &#x51FD;&#x6570;&#x6765;&#x5904;&#x7406;&#xFF1A;</p>
<pre><code>#!/bin/bash
# trap-demo2 : simple signal handling demo
exit_on_signal_SIGINT () {
    echo &quot;Script interrupted.&quot; 2&gt;&amp;1
    exit 0
}
exit_on_signal_SIGTERM () {
    echo &quot;Script terminated.&quot; 2&gt;&amp;1
    exit 0
}
trap exit_on_signal_SIGINT SIGINT
trap exit_on_signal_SIGTERM SIGTERM
for i in {1..5}; do
    echo &quot;Iteration $i of 5&quot;
    sleep 5
done
</code></pre><p>This script features two trap commands, one for each signal. Each trap, in turn, speci-
fies a shell function to be executed when the particular signal is received. Note the inclu-
sion of an exit command in each of the signal-handling functions. Without an exit,
the script would continue after completing the function.</p>
<p>&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x7684;&#x7279;&#x8272;&#x662F;&#x6709;&#x4E24;&#x4E2A; trap &#x547D;&#x4EE4;&#xFF0C;&#x6BCF;&#x4E2A;&#x547D;&#x4EE4;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x3002;&#x6BCF;&#x4E2A; trap&#xFF0C;&#x4F9D;&#x6B21;&#xFF0C;&#x5F53;&#x63A5;&#x53D7;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x7279;&#x6B8A;&#x4FE1;&#x53F7;&#x65F6;&#xFF0C;
&#x4F1A;&#x6267;&#x884C;&#x6307;&#x5B9A;&#x7684; shell &#x51FD;&#x6570;&#x3002;&#x6CE8;&#x610F;&#x6BCF;&#x4E2A;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x4E2D;&#x90FD;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A; exit &#x547D;&#x4EE4;&#x3002;&#x6CA1;&#x6709; exit &#x547D;&#x4EE4;&#xFF0C;
&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x6267;&#x884C;&#x5B8C;&#x540E;&#xFF0C;&#x8BE5;&#x811A;&#x672C;&#x5C06;&#x4F1A;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;</p>
<p>When the user presses Ctrl-c during the execution of this script, the results look like
this:</p>
<p>&#x5F53;&#x7528;&#x6237;&#x5728;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x6267;&#x884C;&#x671F;&#x95F4;&#xFF0C;&#x6309;&#x4E0B; Ctrl-c &#x7EC4;&#x5408;&#x952E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ trap-demo2
Iteration 1 of 5
Iteration 2 of 5
Script interrupted.
</code></pre><blockquote>
<p><em>Temporary Files</em></p>
<p><em>&#x4E34;&#x65F6;&#x6587;&#x4EF6;</em></p>
<p>One reason signal handlers are included in scripts is to remove temporary files
that the script may create to hold intermediate results during execution. There is
something of an art to naming temporary files. Traditionally, programs on Unix-like
systems create their temporary files in the /tmp directory, a shared directory
intended for such files. However, since the directory is shared, this poses certain
security concerns, particularly for programs running with superuser privileges.
Aside from the obvious step of setting proper permissions for files exposed to all
users of the system, it is important to give temporary files non-predictable filenames.
This avoids an exploit known as a temp race attack. One way to create a
non-predictable (but still descriptive) name is to do something like this:</p>
<p>&#x628A;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x5305;&#x542B;&#x5728;&#x811A;&#x672C;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x539F;&#x56E0;&#x662F;&#x5220;&#x9664;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x811A;&#x672C;&#x6267;&#x884C;&#x671F;&#x95F4;&#xFF0C;&#x811A;&#x672C;&#x53EF;&#x80FD;&#x4F1A;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x6765;&#x5B58;&#x653E;&#x4E2D;&#x95F4;&#x7ED3;&#x679C;&#x3002;
&#x547D;&#x540D;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x662F;&#x4E00;&#x79CD;&#x827A;&#x672F;&#x3002;&#x4F20;&#x7EDF;&#x4E0A;&#xFF0C;&#x5728;&#x7C7B;&#x4F3C;&#x4E8E; unix &#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x7A0B;&#x5E8F;&#x4F1A;&#x5728; /tmp &#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x5B83;&#x4EEC;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;/tmp &#x662F;
&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x4E8E;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x662F;&#x5171;&#x4EAB;&#x7684;&#xFF0C;&#x8FD9;&#x4F1A;&#x5F15;&#x8D77;&#x4E00;&#x5B9A;&#x7684;&#x5B89;&#x5168;&#x987E;&#x8651;&#xFF0C;&#x5C24;&#x5176;&#x5BF9;&#x90A3;&#x4E9B;&#x7528;
&#x8D85;&#x7EA7;&#x7528;&#x6237;&#x7279;&#x6743;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x3002;&#x9664;&#x4E86;&#x4E3A;&#x66B4;&#x9732;&#x7ED9;&#x7CFB;&#x7EDF;&#x4E2D;&#x6240;&#x6709;&#x7528;&#x6237;&#x7684;&#x6587;&#x4EF6;&#x8BBE;&#x7F6E;&#x5408;&#x9002;&#x7684;&#x6743;&#x9650;&#x8FD9;&#x4E00;&#x660E;&#x663E;&#x6B65;&#x9AA4;&#x4E4B;&#x5916;&#xFF0C;
&#x7ED9;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x9884;&#x6D4B;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x3002;&#x8FD9;&#x5C31;&#x907F;&#x514D;&#x4E86;&#x4E00;&#x79CD;&#x4E3A;&#x5927;&#x4F17;&#x6240;&#x77E5;&#x7684; temp race &#x653B;&#x51FB;&#x3002;
&#x4E00;&#x79CD;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x9884;&#x6D4B;&#x7684;&#xFF08;&#x4F46;&#x662F;&#x4ECD;&#x6709;&#x610F;&#x4E49;&#x7684;&#xFF09;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#xFF1A;</p>
<p> <em>tempfile=/tmp/$(basename $0).$$.$RANDOM</em></p>
<p>This will create a filename consisting of the program&#x2019;s name, followed by its
process ID (PID), followed by a random integer. Note, however, that the $RANDOM
shell variable only returns a value in the range of 1-32767, which is not a
very large range in computer terms, so a single instance of the variable is not
sufficient to overcome a determined attacker.</p>
<p>&#x8FD9;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7531;&#x7A0B;&#x5E8F;&#x540D;&#x5B57;&#xFF0C;&#x7A0B;&#x5E8F;&#x8FDB;&#x7A0B;&#x7684; ID&#xFF08;PID&#xFF09;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x548C;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x6574;&#x6570;&#x7EC4;&#x6210;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x7136;&#x800C;&#xFF0C;&#x8BE5; $RANDOM shell &#x53D8;&#x91CF;
&#x53EA;&#x80FD;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x5728;1-32767&#x5185;&#x7684;&#x6574;&#x6570;&#x503C;&#xFF0C;&#x8FD9;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x672F;&#x8BED;&#x4E2D;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5927;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x7684;&#x8BE5;&#x53D8;&#x91CF;&#x5B9E;&#x4F8B;&#x662F;&#x4E0D;&#x8DB3;&#x4EE5;&#x514B;&#x670D;&#x4E00;&#x4E2A;&#x575A;&#x5B9A;&#x7684;&#x653B;&#x51FB;&#x8005;&#x7684;&#x3002;</p>
<p>A better way is to use the mktemp program (not to be confused with the mktemp
standard library function) to both name and create the temporary file.
The mktemp program accepts a template as an argument that is used to build the filename.
The template should include a series of &#x201C;X&#x201D; characters, which are replaced
by a corresponding number of random letters and numbers. The longer the series
of &#x201C;X&#x201D; characters, the longer the series of random characters. Here is an example:</p>
<p>&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528; mktemp &#x7A0B;&#x5E8F;&#xFF08;&#x4E0D;&#x8981;&#x548C; mktemp &#x6807;&#x51C6;&#x5E93;&#x51FD;&#x6570;&#x76F8;&#x6DF7;&#x6DC6;&#xFF09;&#x6765;&#x547D;&#x540D;&#x548C;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x3002;
&#x8FD9;&#x4E2A; mktemp &#x7A0B;&#x5E8F;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x6A21;&#x677F;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x3002;&#x8FD9;&#x4E2A;&#x6A21;&#x677F;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x4E00;&#x7CFB;&#x5217;&#x7684; &#x201C;X&#x201D; &#x5B57;&#x7B26;&#xFF0C;
&#x968F;&#x540E;&#x8FD9;&#x4E9B;&#x5B57;&#x7B26;&#x4F1A;&#x88AB;&#x76F8;&#x5E94;&#x6570;&#x91CF;&#x7684;&#x968F;&#x673A;&#x5B57;&#x6BCD;&#x548C;&#x6570;&#x5B57;&#x66FF;&#x6362;&#x6389;&#x3002;&#x4E00;&#x8FDE;&#x4E32;&#x7684; &#x201C;X&#x201D; &#x5B57;&#x7B26;&#x8D8A;&#x957F;&#xFF0C;&#x5219;&#x4E00;&#x8FDE;&#x4E32;&#x7684;&#x968F;&#x673A;&#x5B57;&#x7B26;&#x4E5F;&#x5C31;&#x8D8A;&#x957F;&#x3002;
&#x8FD9;&#x91CC;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<p> <em>tempfile=$(mktemp /tmp/foobar.$$.XXXXXXXXXX)</em></p>
<p>This creates a temporary file and assigns its name to the variable tempfile.
The &#x201C;X&#x201D; characters in the template are replaced with random letters and numbers
so that the final filename (which, in this example, also includes the expanded
value of the special parameter $$ to obtain the PID) might be something like:</p>
<p>&#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x628A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x5B57;&#x8D4B;&#x503C;&#x7ED9;&#x53D8;&#x91CF; tempfile&#x3002;&#x56E0;&#x4E3A;&#x6A21;&#x677F;&#x4E2D;&#x7684; &#x201C;X&#x201D; &#x5B57;&#x7B26;&#x4F1A;&#x88AB;&#x968F;&#x673A;&#x5B57;&#x6BCD;&#x548C;
&#x6570;&#x5B57;&#x4EE3;&#x66FF;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF08;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x4E5F;&#x5305;&#x542B;&#x4E86;&#x7279;&#x6B8A;&#x53C2;&#x6570; $$ &#x7684;&#x5C55;&#x5F00;&#x503C;&#xFF0C;&#x8FDB;&#x7A0B;&#x7684; PID&#xFF09;&#x53EF;&#x80FD;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<p> <em>/tmp/foobar.6593.UOZuvM6654</em></p>
<p>For scripts that are executed by regular users, it may be wise to avoid the use of
the /tmp directory and create a directory for temporary files within the user&#x2019;s
home directory, with a line of code such as this:</p>
<p>&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x7531;&#x666E;&#x901A;&#x7528;&#x6237;&#x64CD;&#x4F5C;&#x6267;&#x884C;&#x7684;&#x811A;&#x672C;&#xFF0C;&#x907F;&#x514D;&#x4F7F;&#x7528; /tmp &#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x7528;&#x6237;&#x5BB6;&#x76EE;&#x5F55;&#x4E0B;&#x4E3A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;
&#x901A;&#x8FC7;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#xFF1A;</p>
<p> <em>[[ -d $HOME/tmp ]] || mkdir $HOME/tmp</em></p>
</blockquote>
<h3 id="&#x5F02;&#x6B65;&#x6267;&#x884C;">&#x5F02;&#x6B65;&#x6267;&#x884C;</h3>
<p>It is sometimes desirable to perform more than one task at the same time. We have seen
how all modern operating systems are at least multitasking if not multiuser as well.
Scripts can be constructed to behave in a multitasking fashion.</p>
<p>&#x6709;&#x65F6;&#x5019;&#x9700;&#x8981;&#x540C;&#x65F6;&#x6267;&#x884C;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x73B0;&#x5728;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x82E5;&#x4E0D;&#x662F;&#x591A;&#x7528;&#x6237;&#x7684;&#x4F46;&#x81F3;&#x5C11;&#x662F;&#x591A;&#x4EFB;&#x52A1;&#x7684;&#x3002;
&#x811A;&#x672C;&#x4E5F;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x6210;&#x591A;&#x4EFB;&#x52A1;&#x5904;&#x7406;&#x7684;&#x6A21;&#x5F0F;&#x3002;</p>
<p>Usually this involves launching a script that, in turn, launches one or more child scripts
that perform an additional task while the parent script continues to run. However, when a
series of scripts runs this way, there can be problems keeping the parent and child coordinated.
That is, what if the parent or child is dependent on the other, and one script must
wait for the other to finish its task before finishing its own?</p>
<p>&#x901A;&#x5E38;&#x8FD9;&#x6D89;&#x53CA;&#x5230;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#xFF0C;&#x4F9D;&#x6B21;&#xFF0C;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5B50;&#x811A;&#x672C;&#x6765;&#x6267;&#x884C;&#x989D;&#x5916;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x800C;&#x7236;&#x811A;&#x672C;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5F53;&#x4E00;&#x7CFB;&#x5217;&#x811A;&#x672C;
&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x8981;&#x4FDD;&#x6301;&#x7236;&#x5B50;&#x811A;&#x672C;&#x4E4B;&#x95F4;&#x534F;&#x8C03;&#x5DE5;&#x4F5C;&#xFF0C;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x82E5;&#x7236;&#x811A;&#x672C;&#x6216;&#x5B50;&#x811A;&#x672C;&#x4F9D;&#x8D56;&#x4E8E;&#x53E6;&#x4E00;&#x65B9;&#xFF0C;&#x5E76;&#x4E14;
&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x53E6;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x7ED3;&#x675F;&#x4EFB;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x624D;&#x80FD;&#x5B8C;&#x6210;&#x5B83;&#x81EA;&#x5DF1;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#xFF1F;</p>
<p>bash has a builtin command to help manage asynchronous execution such as this. The
wait command causes a parent script to pause until a specified process (i.e., the child
script) finishes.</p>
<p>bash &#x6709;&#x4E00;&#x4E2A;&#x5185;&#x7F6E;&#x547D;&#x4EE4;&#xFF0C;&#x80FD;&#x5E2E;&#x52A9;&#x7BA1;&#x7406;&#x8BF8;&#x5982;&#x6B64;&#x7C7B;&#x7684;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x3002;wait &#x547D;&#x4EE4;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x7236;&#x811A;&#x672C;&#x6682;&#x505C;&#x8FD0;&#x884C;&#xFF0C;&#x76F4;&#x5230;&#x4E00;&#x4E2A;
&#x7279;&#x5B9A;&#x7684;&#x8FDB;&#x7A0B;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x5B50;&#x811A;&#x672C;&#xFF09;&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x3002;</p>
<h4 id="&#x7B49;&#x5F85;">&#x7B49;&#x5F85;</h4>
<p>We will demonstrate the wait command first. To do this, we will need two scripts, a par-
ent script:</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5C06;&#x6F14;&#x793A;&#x4E00;&#x4E0B; wait &#x547D;&#x4EE4;&#x7684;&#x7528;&#x6CD5;&#x3002;&#x4E3A;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x811A;&#x672C;&#xFF0C;&#x4E00;&#x4E2A;&#x7236;&#x811A;&#x672C;&#xFF1A;</p>
<pre><code>#!/bin/bash
# async-parent : Asynchronous execution demo (parent)
echo &quot;Parent: starting...&quot;
echo &quot;Parent: launching child script...&quot;
async-child &amp;
pid=$!
echo &quot;Parent: child (PID= $pid) launched.&quot;
echo &quot;Parent: continuing...&quot;
sleep 2
echo &quot;Parent: pausing to wait for child to finish...&quot;
wait $pid
echo &quot;Parent: child is finished. Continuing...&quot;
echo &quot;Parent: parent is done. Exiting.&quot;
</code></pre><p>and a child script:</p>
<p>&#x548C;&#x4E00;&#x4E2A;&#x5B50;&#x811A;&#x672C;&#xFF1A;</p>
<pre><code>#!/bin/bash
# async-child : Asynchronous execution demo (child)
echo &quot;Child: child is running...&quot;
sleep 5
echo &quot;Child: child is done. Exiting.&quot;
</code></pre><p>In this example, we see that the child script is very simple. The real action is being per-
formed by the parent. In the parent script, the child script is launched and put into the
background. The process ID of the child script is recorded by assigning the pid variable
with the value of the $! shell parameter, which will always contain the process ID of the
last job put into the background.</p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x8BE5;&#x5B50;&#x811A;&#x672C;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x3002;&#x771F;&#x6B63;&#x7684;&#x64CD;&#x4F5C;&#x901A;&#x8FC7;&#x7236;&#x811A;&#x672C;&#x5B8C;&#x6210;&#x3002;&#x5728;&#x7236;&#x811A;&#x672C;&#x4E2D;&#xFF0C;&#x5B50;&#x811A;&#x672C;&#x88AB;&#x542F;&#x52A8;&#xFF0C;
&#x5E76;&#x88AB;&#x653E;&#x7F6E;&#x5230;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x3002;&#x5B50;&#x811A;&#x672C;&#x7684;&#x8FDB;&#x7A0B; ID &#x8BB0;&#x5F55;&#x5728; pid &#x53D8;&#x91CF;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x662F; $! shell &#x53C2;&#x6570;&#x7684;&#x503C;&#xFF0C;&#x5B83;&#x603B;&#x662F;
&#x5305;&#x542B;&#x653E;&#x5230;&#x540E;&#x53F0;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;&#x8FDB;&#x7A0B; ID &#x53F7;&#x3002;</p>
<p>The parent script continues and then executes a wait command with the PID of the child
process. This causes the parent script to pause until the child script exits, at which point
the parent script concludes.</p>
<p>&#x7236;&#x811A;&#x672C;&#x7EE7;&#x7EED;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x4EE5;&#x5B50;&#x8FDB;&#x7A0B; PID &#x4E3A;&#x53C2;&#x6570;&#x7684; wait &#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x5C31;&#x5BFC;&#x81F4;&#x7236;&#x811A;&#x672C;&#x6682;&#x505C;&#x8FD0;&#x884C;&#xFF0C;&#x76F4;&#x5230;&#x5B50;&#x811A;&#x672C;&#x9000;&#x51FA;&#xFF0C;
&#x610F;&#x5473;&#x7740;&#x7236;&#x811A;&#x672C;&#x7ED3;&#x675F;&#x3002;</p>
<p>When executed, the parent and child scripts produce the following output:</p>
<p>&#x5F53;&#x6267;&#x884C;&#x540E;&#xFF0C;&#x7236;&#x5B50;&#x811A;&#x672C;&#x4EA7;&#x751F;&#x5982;&#x4E0B;&#x8F93;&#x51FA;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ async-parent
Parent: starting...
Parent: launching child script...
Parent: child (PID= 6741) launched.
Parent: continuing...
Child: child is running...
Parent: pausing to wait for child to finish...
Child: child is done. Exiting.
Parent: child is finished. Continuing...
Parent: parent is done. Exiting.
</code></pre><h3 id="&#x547D;&#x540D;&#x7BA1;&#x9053;">&#x547D;&#x540D;&#x7BA1;&#x9053;</h3>
<p>In most Unix-like systems, it is possible to create a special type of file called a named
pipe. Named pipes are used to create a connection between two processes and can be
used just like other types of files. They are not that popular, but they&#x2019;re good to know
about.</p>
<p>&#x5728;&#x5927;&#x591A;&#x6570;&#x7C7B;&#x4F3C; Unix &#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x521B;&#x5EFA;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x53EB;&#x505A;&#x547D;&#x540D;&#x7BA1;&#x9053;&#x3002;&#x547D;&#x540D;&#x7BA1;&#x9053;&#x7528;&#x6765;&#x5728;
&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x50CF;&#x5176;&#x5B83;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;&#x4E00;&#x6837;&#x4F7F;&#x7528;&#x3002;&#x867D;&#x7136;&#x5B83;&#x4EEC;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x6D41;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x503C;&#x5F97;&#x6211;&#x4EEC;&#x53BB;&#x4E86;&#x89E3;&#x3002;</p>
<p>There is a common programming architecture called client-server, which can make use of
a communication method such as named pipes, as well as other kinds of interprocess
communication such as network connections.</p>
<p>&#x6709;&#x4E00;&#x79CD;&#x5E38;&#x89C1;&#x7684;&#x7F16;&#x7A0B;&#x67B6;&#x6784;&#xFF0C;&#x53EB;&#x505A;&#x5BA2;&#x6237;&#x7AEF;-&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x50CF;&#x547D;&#x540D;&#x7BA1;&#x9053;&#x8FD9;&#x6837;&#x7684;&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#xFF0C;
&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x7C7B;&#x578B;&#x7684;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x3002;</p>
<p>The most widely used type of client-server system is, of course, a web browser
communicating with a web server. The web browser acts as the client, making requests to the
server and the server responds to the browser with web pages.</p>
<p>&#x6700;&#x4E3A;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x5BA2;&#x6237;&#x7AEF;-&#x670D;&#x52A1;&#x5668;&#x7CFB;&#x7EDF;&#x7C7B;&#x578B;&#x662F;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x4E00;&#x4E2A; web &#x6D4F;&#x89C8;&#x5668;&#x4E0E;&#x4E00;&#x4E2A; web &#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;
web &#x6D4F;&#x89C8;&#x5668;&#x4F5C;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x51FA;&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x628A;&#x5BF9;&#x5E94;&#x7684;&#x7F51;&#x9875;&#x53D1;&#x9001;&#x7ED9;&#x6D4F;&#x89C8;&#x5668;&#x3002;</p>
<p>Named pipes behave like files, but actually form first-in first-out (FIFO) buffers. As with
ordinary (unnamed) pipes, data goes in one end and emerges out the other. With named
pipes, it is possible to set up something like this:</p>
<p>&#x547D;&#x4EE4;&#x7BA1;&#x9053;&#x7684;&#x884C;&#x4E3A;&#x7C7B;&#x4F3C;&#x4E8E;&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5F62;&#x6210;&#x4E86;&#x5148;&#x5165;&#x5148;&#x51FA;&#xFF08;FIFO&#xFF09;&#x7684;&#x7F13;&#x51B2;&#x3002;&#x548C;&#x666E;&#x901A;&#xFF08;&#x672A;&#x547D;&#x4EE4;&#x7684;&#xFF09;&#x7BA1;&#x9053;&#x4E00;&#x6837;&#xFF0C;
&#x6570;&#x636E;&#x4ECE;&#x4E00;&#x7AEF;&#x8FDB;&#x5165;&#xFF0C;&#x7136;&#x540E;&#x4ECE;&#x53E6;&#x4E00;&#x7AEF;&#x51FA;&#x73B0;&#x3002;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x7BA1;&#x9053;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x50CF;&#x8FD9;&#x6837;&#x8BBE;&#x7F6E;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#xFF1A;</p>
<pre><code>process1 &gt; named_pipe
</code></pre><p>and</p>
<p>&#x548C;</p>
<pre><code>process2 &lt; named_pipe
</code></pre><p>and it will behave as if:</p>
<p>&#x8868;&#x73B0;&#x51FA;&#x6765;&#x5C31;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code>process1 | process2
</code></pre><h4 id="&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7BA1;&#x9053;">&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7BA1;&#x9053;</h4>
<p>First, we must create a named pipe. This is done using the mkfifo command:</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7BA1;&#x9053;&#x3002;&#x4F7F;&#x7528; mkfifo &#x547D;&#x4EE4;&#x80FD;&#x591F;&#x521B;&#x5EFA;&#x547D;&#x4EE4;&#x7BA1;&#x9053;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ mkfifo pipe1
[me@linuxbox ~]$ ls -l pipe1
prw-r--r-- 1 me
me
0 2009-07-17 06:41 pipe1
</code></pre><p>Here we use mkfifo to create a named pipe called pipe1. Using ls, we examine the
file and see that the first letter in the attributes field is &#x201C;p&#x201D;,
indicating that it is a named pipe.</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528; mkfifo &#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; pipe1 &#x7684;&#x547D;&#x540D;&#x7BA1;&#x9053;&#x3002;&#x4F7F;&#x7528; ls &#x547D;&#x4EE4;&#xFF0C;&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;
&#x770B;&#x5230;&#x4F4D;&#x4E8E;&#x5C5E;&#x6027;&#x5B57;&#x6BB5;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BCD;&#x662F; &#x201C;p&#x201D;&#xFF0C;&#x8868;&#x660E;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7BA1;&#x9053;&#x3002;</p>
<h4 id="&#x4F7F;&#x7528;&#x547D;&#x540D;&#x7BA1;&#x9053;">&#x4F7F;&#x7528;&#x547D;&#x540D;&#x7BA1;&#x9053;</h4>
<p>To demonstrate how the named pipe works, we will need two terminal
windows (or alternately, two virtual consoles). In the first terminal,
we enter a simple command and redirect its output to the named pipe:</p>
<p>&#x4E3A;&#x4E86;&#x6F14;&#x793A;&#x547D;&#x540D;&#x7BA1;&#x9053;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#xFF08;&#x6216;&#x7528;&#x4E24;&#x4E2A;&#x865A;&#x62DF;&#x63A7;&#x5236;&#x53F0;&#x4EE3;&#x66FF;&#xFF09;&#x3002;
&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8F93;&#x5165;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x547D;&#x4EE4;&#xFF0C;&#x5E76;&#x628A;&#x547D;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x547D;&#x540D;&#x7BA1;&#x9053;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ ls -l &gt; pipe1
</code></pre><p>After we press the Enter key, the command will appear to hang. This is because there is
nothing receiving data from the other end of the pipe yet. When this occurs, it is said that
the pipe is blocked. This condition will clear once we attach a process to the other end
and it begins to read input from the pipe. Using the second terminal window, we enter
this command:</p>
<p>&#x6211;&#x4EEC;&#x6309;&#x4E0B; Enter &#x6309;&#x952E;&#x4E4B;&#x540E;&#xFF0C;&#x547D;&#x4EE4;&#x5C06;&#x4F1A;&#x6302;&#x8D77;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5728;&#x7BA1;&#x9053;&#x7684;&#x53E6;&#x4E00;&#x7AEF;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x63A5;&#x53D7;&#x6570;&#x636E;&#x3002;&#x5F53;&#x8FD9;&#x79CD;&#x73B0;&#x8C61;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x5019;&#xFF0C;
&#x636E;&#x8BF4;&#x662F;&#x7BA1;&#x9053;&#x963B;&#x585E;&#x4E86;&#x3002;&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5230;&#x7BA1;&#x9053;&#x7684;&#x53E6;&#x4E00;&#x7AEF;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x5F00;&#x59CB;&#x4ECE;&#x7BA1;&#x9053;&#x4E2D;&#x8BFB;&#x53D6;&#x8F93;&#x5165;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4F1A;&#x6D88;&#x5931;&#x3002;
&#x4F7F;&#x7528;&#x7B2C;&#x4E8C;&#x4E2A;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#xFF0C;&#x6211;&#x4EEC;&#x8F93;&#x5165;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code>[me@linuxbox ~]$ cat &lt; pipe1
</code></pre><p>and the directory listing produced from the first terminal window appears in the second
terminal as the output from the cat command. The ls command in the first terminal
successfully completes once it is no longer blocked.</p>
<p>&#x7136;&#x540E;&#x4EA7;&#x81EA;&#x7B2C;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#x7684;&#x76EE;&#x5F55;&#x5217;&#x8868;&#x51FA;&#x73B0;&#x5728;&#x7B2C;&#x4E8C;&#x4E2A;&#x7EC8;&#x7AEF;&#x4E2D;&#xFF0C;&#x5E76;&#x4F5C;&#x4E3A;&#x6765;&#x81EA; cat &#x547D;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x3002;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;
&#x7A97;&#x53E3;&#x4E2D;&#x7684; ls &#x547D;&#x4EE4;&#x4E00;&#x65E6;&#x5B83;&#x4E0D;&#x518D;&#x963B;&#x585E;&#xFF0C;&#x4F1A;&#x6210;&#x529F;&#x5730;&#x7ED3;&#x675F;&#x3002;</p>
<h3 id="&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</h3>
<p>Well, we have completed our journey. The only thing left to do now is practice, practice,
practice. Even though we covered a lot of ground in our trek, we barely scratched
the surface as far as the command line goes. There are still thousands of command line
programs left to be discovered and enjoyed. Start digging around in /usr/bin and you&#x2019;ll see!</p>
<p>&#x55EF;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x65C5;&#x7A0B;&#x3002;&#x73B0;&#x5728;&#x5269;&#x4E0B;&#x7684;&#x552F;&#x4E00;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x5C31;&#x662F;&#x7EC3;&#x4E60;&#xFF0C;&#x7EC3;&#x4E60;&#xFF0C;&#x518D;&#x7EC3;&#x4E60;&#x3002;
&#x7EB5;&#x7136;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x957F;&#x9014;&#x8DCB;&#x6D89;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6D89;&#x53CA;&#x4E86;&#x5F88;&#x591A;&#x547D;&#x4EE4;&#xFF0C;&#x4F46;&#x662F;&#x5C31;&#x547D;&#x4EE4;&#x884C;&#x800C;&#x8A00;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x89E6;&#x53CA;&#x4E86;&#x5B83;&#x7684;&#x8868;&#x9762;&#x3002;
&#x4ECD;&#x7559;&#x6709;&#x6210;&#x5343;&#x4E0A;&#x4E07;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x7A0B;&#x5E8F;&#xFF0C;&#x9700;&#x8981;&#x53BB;&#x53D1;&#x73B0;&#x548C;&#x4EAB;&#x53D7;&#x3002;&#x5F00;&#x59CB;&#x6316;&#x6398; /usr/bin &#x76EE;&#x5F55;&#x5427;&#xFF0C;&#x4F60;&#x5C06;&#x4F1A;&#x770B;&#x5230;&#xFF01;</p>
<h3 id="&#x62D3;&#x5C55;&#x9605;&#x8BFB;">&#x62D3;&#x5C55;&#x9605;&#x8BFB;</h3>
<ul>
<li><p>The &#x201C;Compound Commands&#x201D; section of the bash man page contains a full
description of group command and subshell notations.</p>
</li>
<li><p>bash &#x624B;&#x518C;&#x9875;&#x7684; &#x201C;&#x590D;&#x5408;&#x547D;&#x4EE4;&#x201D; &#x90E8;&#x5206;&#x5305;&#x542B;&#x4E86;&#x5BF9;&#x7EC4;&#x547D;&#x4EE4;&#x548C;&#x5B50; shell &#x8868;&#x793A;&#x6CD5;&#x7684;&#x8BE6;&#x5C3D;&#x63CF;&#x8FF0;&#x3002;</p>
</li>
<li><p>The EXPANSION section of the bash man page contains a subsection of process
substitution.</p>
</li>
<li><p>bash &#x624B;&#x518C;&#x4E5F;&#x7684; EXPANSION &#x90E8;&#x5206;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
</li>
<li><p>The Advanced Bash-Scripting Guide also has a discussion of process substitution:</p>
</li>
<li><p>&#x300A;&#x9AD8;&#x7EA7; Bash &#x811A;&#x672C;&#x6307;&#x5357;&#x300B;&#x4E5F;&#x6709;&#x5BF9;&#x8FDB;&#x7A0B;&#x66FF;&#x6362;&#x7684;&#x8BA8;&#x8BBA;&#xFF1A;</p>
<p>  <a href="http://tldp.org/LDP/abs/html/process-sub.html" target="_blank">http://tldp.org/LDP/abs/html/process-sub.html</a></p>
</li>
<li><p>Linux Journal has two good articles on named pipes. The first, from September 1997:</p>
</li>
<li><p>&#x300A;Linux &#x6742;&#x5FD7;&#x300B;&#x6709;&#x4E24;&#x7BC7;&#x5173;&#x4E8E;&#x547D;&#x4EE4;&#x7BA1;&#x9053;&#x7684;&#x597D;&#x6587;&#x7AE0;&#x3002;&#x7B2C;&#x4E00;&#x7BC7;&#xFF0C;&#x6E90;&#x4E8E;1997&#x5E74;9&#x6708;&#xFF1A;</p>
<p>  <a href="http://www.linuxjournal.com/article/2156" target="_blank">http://www.linuxjournal.com/article/2156</a></p>
</li>
<li><p>and the second, from March 2009:</p>
</li>
<li><p>&#x548C;&#x7B2C;&#x4E8C;&#x7BC7;&#xFF0C;&#x6E90;&#x4E8E;2009&#x5E74;3&#x6708;&#xFF1A;</p>
<p>  <a href="http://www.linuxjournal.com/content/using-named-pipes-fifos-bash" target="_blank">http://www.linuxjournal.com/content/using-named-pipes-fifos-bash</a></p>
</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="chap36.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 36. 数组">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"layout":"book","title":"37. 奇珍异宝","level":"1.1.37","depth":2,"previous":{"title":"36. 数组","level":"1.1.36","depth":2,"path":"chap36.md","ref":"chap36.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"en","gitbook":"*"},"file":{"path":"chap37.md","mtime":"2017-01-12T13:21:32.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-01-12T13:23:32.099Z"},"basePath":".","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

